import{c as n,r as l,j as e,B as g}from"./index-373623be.js";import{u as N,h as r,T as M,d as Y,e as i,C as b,a as w,l as k,m as E,B as h,c as C,b as T,g as D}from"./booking-7e8d89c4.js";import"./axios-b9f16ce4.js";const A=n("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),q=n("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]),B=n("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),_=n("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function U(){const[u,p]=l.useState([]),[j,d]=l.useState(!0),[m,y]=l.useState("upcoming"),{toast:f}=N(),v=s=>{var a;return{id:((a=s.id)==null?void 0:a.toString())||"",title:s.activity_title,requestor:s.requestor_name,equipments:s.equipment.map(t=>({name:t.name,quantity:t.quantity})),start:new Date(`${s.start_date} ${s.start_time}`),end:new Date(`${s.end_date} ${s.end_time}`),status:s.status,remarks:s.remarks||""}},o=async()=>{d(!0);try{const a=(await D()).map(t=>v(t)).filter(t=>t.status==="approved");p(a)}catch(s){console.error("Failed to fetch events:",s),f({title:"Error",description:"Failed to load events. Please try again.",variant:"destructive"})}finally{d(!1)}};l.useEffect(()=>{o()},[]);const x=[...u.filter(s=>{const a=new Date;switch(m){case"upcoming":return s.start>=a;case"today":return r(s.start).isSame(r(a),"day");case"all":default:return!0}})].sort((s,a)=>s.start.getTime()-a.start.getTime()).reduce((s,a)=>{const t=r(a.start).format("MMMM YYYY");return s[t]||(s[t]=[]),s[t].push(a),s},{});return e.jsxs("div",{className:"container mx-auto py-8 px-4 max-w-6xl",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Events Calendar"}),e.jsxs(M,{defaultValue:"upcoming",value:m,onValueChange:s=>y(s),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs(Y,{children:[e.jsx(i,{value:"upcoming",className:"px-4",children:"Upcoming Events"}),e.jsx(i,{value:"today",className:"px-4",children:"Today's Events"}),e.jsx(i,{value:"all",className:"px-4",children:"All Approved Events"})]}),e.jsx(g,{variant:"outline",onClick:o,children:"Refresh"})]}),j?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin h-10 w-10 border-4 border-blue-500 border-t-transparent rounded-full"})}):e.jsx("div",{children:Object.keys(x).length>0?Object.entries(x).map(([s,a])=>e.jsxs("div",{className:"mb-10",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 border-b pb-2",children:s}),e.jsx("div",{className:"space-y-4",children:a.map(t=>e.jsxs(b,{className:"overflow-hidden hover:shadow-md transition-shadow",children:[e.jsx(w,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(k,{className:"text-xl mb-1",children:t.title}),e.jsxs(E,{className:"flex items-center",children:[e.jsx(_,{className:"h-4 w-4 mr-1"}),t.requestor]})]}),e.jsx(h,{className:"bg-green-100 text-green-800 hover:bg-green-200",children:"Approved"})]})}),e.jsx(C,{className:"pt-0",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(T,{className:"h-5 w-5 mr-2 text-gray-500 mt-0.5"}),e.jsx("div",{children:r(t.start).format("YYYY-MM-DD")!==r(t.end).format("YYYY-MM-DD")?e.jsxs("span",{className:"text-gray-700",children:[r(t.start).format("MMM D, YYYY")," to ",r(t.end).format("MMM D, YYYY")]}):e.jsx("span",{className:"text-gray-700",children:r(t.start).format("MMM D, YYYY")})})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(A,{className:"h-5 w-5 mr-2 text-gray-500 mt-0.5"}),e.jsxs("span",{className:"text-gray-700",children:[r(t.start).format("h:mm A")," - ",r(t.end).format("h:mm A")]})]}),t.equipments.length>0&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(B,{className:"h-5 w-5 mr-2 text-gray-500 mt-0.5"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.equipments.map(c=>e.jsxs(h,{variant:"outline",className:"bg-gray-50",children:[c.name," (",c.quantity,")"]},c.name))})]}),t.remarks&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(q,{className:"h-5 w-5 mr-2 text-gray-500 mt-0.5"}),e.jsx("p",{className:"text-sm text-gray-600 italic",children:t.remarks})]})]})})]},t.id))})]},s)):e.jsxs("div",{className:"text-center py-16",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:"No events found for this filter"}),e.jsx("p",{className:"text-gray-400",children:"Try changing your filter or check back later"})]})})]})]})}export{U as default};
